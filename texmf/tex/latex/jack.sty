\ProvidesPackage {jack}

\newif \ifjackcolour \jackcolourfalse
\newif \ifjacksection \jacksectiontrue
\newif \ifevan \evanfalse 
\newif \ifindex \indextrue
\newif \ifjackwide \jackwidefalse 
\newif \ifjackbeautiful \jackbeautifulfalse
\newif \ifjackcourse \jackcoursefalse
\newif \ifjackannot
\newif \ifnone \nonefalse
\newif \ifams \amsfalse
\newif \ifthing \thingfalse
\newif \ifscr \scrfalse
\newif \ifassg \assgfalse
\newif \ifold \oldfalse
\newif \iffrench \frenchfalse
\newif \ifslides \slidesfalse
\newif \ifplaintitle \plaintitlefalse
\newif \iftesting \testingfalse
\newif \ifmanim \manimfalse


% TODO: Add arg options

\DeclareOption {old} {\oldtrue}
	% only useful \ifoldtrue
	\DeclareOption {colour} {\jackcolourtrue}
	\DeclareOption {nocolour} {\jackcolourfalse}
	\DeclareOption {nosection} {\jacksectionfalse}
	\DeclareOption {evan} {\evantrue}
\DeclareOption {noindex} {\indexfalse}
\DeclareOption {course} {\jackcoursetrue}
\DeclareOption {none} {\nonetrue}
\DeclareOption {ams} {\amstrue}
\DeclareOption {annot} {\jackannottrue}
\DeclareOption {scr} {\scrtrue}
\DeclareOption {assg} {\assgtrue}
\DeclareOption {french} {\frenchtrue}
\DeclareOption {slides} {\slidestrue}
\DeclareOption {plaintitle} {\plaintitletrue}
\DeclareOption {testing} {\testingtrue}
\DeclareOption {manim} {\manimtrue}

% USELESS OPTIONS
\DeclareOption {wide} {\jackwidetrue}
\DeclareOption {beautiful} {\jackbeautifultrue}
\DeclareOption {thing} {\thingtrue}

\ProcessOptions\relax

\RequirePackage {tipa}	% Before amsmath resolves errors like ``command \; invalid in math mode'' and ``missing } inserted'' with \implies
\ifslides
\else
	\RequirePackage [usenames, svgnames, dvipsnames] {xcolor}
\fi


\RequirePackage {amsthm}



\RequirePackage {MnSymbol}
%\RequirePackage {amssymb, amsfonts, amsmath}



\RequirePackage {microtype}
%\DisableLigatures{encoding = *, family = * }

\RequirePackage {thmtools}
\RequirePackage [framemethod = TikZ] {mdframed}
\RequirePackage {mathtools}
\RequirePackage {imakeidx} % add `\makeindex[intoc]' in preamble to get index in toc

\RequirePackage {ifluatex}

\makeatletter
	\ifdefined\frontmatter
		
	\else
		\newcommand\frontmatter {%
    			\cleardoublepage
  			% \@mainmatterfalse
  			\pagenumbering {roman}
		}
	\fi
	
	\ifdefined\mainmatter

	\else
		\newcommand\mainmatter {%
    			\cleardoublepage
 			% \@mainmattertrue
  			\pagenumbering {arabic}
		}
	\fi
	
	\ifdefined\backmatter

	\else
		\newcommand\backmatter {%
			\if@openright
    				\cleardoublepage
 			 \else
    				\clearpage
  			\fi
 		% \@mainmatterfalse
		}
	\fi
\makeatother



\RequirePackage {enumitem}
\RequirePackage {graphicx}
\RequirePackage {parcolumns}
\RequirePackage {polynom}
\RequirePackage {multicol}
\RequirePackage {tikz}
\RequirePackage {tikz-cd}
\RequirePackage {tikz-3dplot}
%\RequirePackage {manfnt}
%\RequirePackage {stmaryrd}
\RequirePackage {wasysym}
\RequirePackage {listings}
\RequirePackage {spverbatim}
\RequirePackage {scrextend}
\RequirePackage {booktabs}
\RequirePackage {siunitx}
\RequirePackage {ifmtarg}
\RequirePackage {kvoptions}
%\RequirePackage {esint}
\RequirePackage [usestackEOL] {stackengine}
\RequirePackage {soul}
\RequirePackage {scalerel}
\RequirePackage {pgfplots}
\RequirePackage {latexsym}
\RequirePackage [makeroom] {cancel}
\RequirePackage {setspace}
\RequirePackage {mathdots}
\RequirePackage {parskip}


\ifscr
	\RequirePackage [headsepline] {scrlayer-scrpage}
\else
	\RequirePackage [T1] {fontenc}	% Screws up fonts
								% Also cannot use T2A

    \RequirePackage [utf8x] {inputenc}
    \RequirePackage [scaled] {beramono} 
    
	\RequirePackage {regexpatch}	% Clashes with `scrlayer-scrpage`
	\RequirePackage {fancyhdr}
        \setlength {\headheight} {15 pt} % Response to ``Package fancyhdr Warning: \headheight is too small''
\fi

\ifluatex
    %\RequirePackage {frenchmath}
    %\RequirePackage [frenchmath] {newtxmath}
    \RequirePackage [math-style = french] {unicode-math}
    
    \let\mathscr\relax   
    \AtBeginDocument{
    \renewcommand{\setminus}{\mathbin{\backslash}}%
}
\fi

%\RequirePackage {eucal}
\RequirePackage {mathrsfs}
\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n}


\iffalse    % DEPRECATED (default colours for specific styles)
    \ifjackcourse
        \RequirePackage [colorlinks, linkcolor = RawSienna, citecolor = black, urlcolor = Blue] {hyperref}
        %\RequirePackage {hyperref}
    \else
        \ifjackcolour
            \RequirePackage [colorlinks, linkcolor = RoyalBlue] {hyperref}
            %\RequirePackage {hyperref}
        \else
            \ifjackannot
                \RequirePackage [colorlinks, linkcolor = RawSienna, citecolor = black, urlcolor = Blue] {hyperref}
            \else
                \RequirePackage [hidelinks] {hyperref} % colorlinks = true, linkcolor = black
            \fi
        \fi
    \fi
\fi

%\RequirePackage [colorlinks, linkcolor = Red, citecolor = red, urlcolor = Blue] {hyperref}
\RequirePackage [colorlinks, linkcolor = Black, citecolor = Black, urlcolor = Black] {hyperref}

\RequirePackage {cleveref}	% no `nameinlink' or `capitalize'
\crefname {equation} {} {}

\setlength {\emergencystretch} {14 pt}  % Response to ``Overfull \hbox''

\usetikzlibrary {arrows, trees, backgrounds, decorations.text, calc, arrows.meta}

\tikzset {
	commutative diagrams/.cd,
	%arrow style = tikz,
	arrow style = math font,
	%diagrams = {>= latex}
}

\tikzset{>=latex}

% https://tex.stackexchange.com/questions/401024/drawing-overlapping-3d-cones
\newcommand {\coneback} [4] [] {
	\draw[canvas is xy plane at z=#2, #1] (45-#4:#3) arc (45-#4:225+#4:#3) -- (O) --cycle;
}
\newcommand {\conefront} [4] [] {
	\draw[canvas is xy plane at z=#2, #1] (45-#4:#3) arc (45-#4:-135+#4:#3) -- (O) --cycle;
}

\iffalse	% DEPRECATED (change section/subsection header styles)

	\RequirePackage {titlesec}
	\setcounter {tocdepth} {2}

	\titleformat {\section} {} {\thesection} {1em} {}
	\titleformat {\subsection}   {\normalfont\bfseries} {} {0em} {}

	\makeatletter
		\renewcommand{\section}{\@startsection
			{section}
			{1}
			{\z@}
			{-\baselineskip}
			{0.5\baselineskip}
			{\large\scshape\bfseries\noindent\S}}					
	\makeatother

	\let \oldsection \subsection

	\makeatletter
		\renewcommand {\subsection} [2] [] {
			\@ifmtarg {#1}%
			{\oldsection {#2.}}
			{\oldsection [#1] {#2.}}
		}
	\makeatother

	\iffalse
		\makeatletter
			\renewcommand {\section} {\@startsection
				{section}			% name
				{1}				% level
				{\z@}				% the indent / 0mm
				{-\baselineskip}		% before skip / -3.5ex \@plus -1ex \@minus -.2ex
				{0.5\baselineskip}		% after skip / 2.3ex \@plus .2ex
				{\bfseries\large}} 		% style
		\makeatother
	\fi
	
\fi


\makeatletter
	\renewcommand* \env@matrix [1] [\arraystretch] {
		\edef \arraystretch {#1}
		\hskip -\arraycolsep
		\let \@ifnextchar \new@ifnextchar
		\array {*\c@MaxMatrixCols c}
	}
\makeatother


\RequirePackage {geometry} 


\newcommand {\0} {\underline{0}}
\let \A \relax
\newcommand {\A} {\mathbf{A}} 
\newcommand {\abs} [1] {\left \lvert #1 \right \rvert}  
\newcommand {\Alt} {\mathfrak{A}}    
\let \ang \relax
\newcommand {\ang} [1] {\left \langle #1 \right \rangle}
\newcommand {\cat} [1] {\mathscr #1} 
\newcommand {\catn} [1] {\textsf{#1}} 

\def \firstletter #1#2@{#1}
\def \reststring #1#2@{#2}
\newcommand {\catnold} [1] {\mathcal{\firstletter#1@}\mathrm{\reststring#1@}} 

\newcommand {\ceiling} [1] {\left \lceil #1 \right \rceil} 
\newcommand {\C} {\mathbf C} 
\newcommand {\Cyc} {\mathfrak{C}} 
\newcommand {\dg} {^\circ} 
\newcommand {\Di} {\mathfrak{D}} 
\newcommand {\du} [1] {\underline{\underline{#1}}} 
\let \epsilon \varepsilon
\newcommand {\eps} {\varepsilon}
\newcommand {\floor} [1] {\left \lfloor #1 \right \rfloor} 
\newcommand {\F} {\mathbf F} 
\newcommand {\Fs} {\mathscr F} 
\newcommand {\Grp} {\catn {Grp}} 
\let \H \relax
\newcommand {\H} {\mathbf H} 
\newcommand {\hh} {\mathfrak H} 
\let \hookrightarrow \relax
\let \hookleftarrow \relax
\newcommand {\hookrightarrow} {\lhook\joinrel\longrightarrow}
\newcommand {\hookleftarrow} {\longleftarrow\joinrel\rhook}
\newcommand {\indx} [2] {\left [#1 : #2 \right]}  
\newcommand {\inv} {^{-1}} 
\newcommand {\isomto} {\cong}  
\let \K \relax
\newcommand {\K} {\mathbf K} 
\newcommand {\LL} {\mathcal L} 
\newcommand {\lrd} {\mathfrak{d}} 
\newcommand {\mailto} [1] {\href {mailto : #1} {\texttt{#1}}}
\newcommand {\mat} [1] {\begin{pmatrix} [1.2] #1\end{pmatrix}}
\newcommand {\mf} {\mathfrak} 
\newcommand {\mm} {\mathfrak m} 
\newcommand {\Ms} {\mathscr M} 
\newcommand {\norm} [1] {\left \lVert #1 \right \rVert} 
\newcommand {\N} {\mathbf N} 
\newcommand {\ol} {\overline}
\newcommand {\OO} {\mathcal O} 
\newcommand {\oo} {\mathfrak o} 
\let \P \relax
\newcommand {\P} {\mathbf P} 
\newcommand {\pp} {\mathfrak p} 
\newcommand {\Q} {\mathbf Q}
\newcommand {\R} {\mathbf R} 
\newcommand {\Ring} {\catn {Ring}} 
\newcommand {\Set} {\catn {Set}} 
\let \sh \relax
\newcommand {\shf} {^\sharp}
\newcommand {\Sy} {\mathfrak{S}}
\newcommand {\Simp} {\text{{\scshape Simp}}}
\newcommand {\tensor} {\otimes}
\let \super \relax
\newcommand {\sub} [1] {_{\textup {#1}}}
\newcommand {\super} [1] {^{\textup {#1}}}
\newcommand {\op} {\super{op}}
\newcommand {\opn} [1] {\norm {#1}\sub{op}}
\newcommand {\sh} {\super{sh}}
\newcommand {\T} {\mathbf{T}}
\newcommand {\tp} {{}^{\mathrm{t}}\!}
\newcommand {\Trig} {\text{{\scshape Trig}}}
\newcommand {\wh} {\widehat}
\newcommand {\wt} {\widetilde}
\newcommand {\X} {\mathfrak{X}}
\newcommand {\Y} {\mathfrak{Y}}
\newcommand {\Z} {\mathbf{Z}}
\newcommand {\Zf} {\mathfrak{Z}}


\DeclareMathOperator* {\argmax} {arg max}
\DeclareMathOperator* {\argmin} {arg min}
%\DeclareMathOperator* {\bigtimes} {\scalerel*{\times}{\bigotimes}} % bad when mnsymbol
\DeclareMathOperator* {\colim} {colim}                      		
\DeclareMathOperator* {\lcm} {lcm}
\DeclareMathOperator* {\sotlim} {\textsc{sot}-lim}
\DeclareMathOperator* {\wotlim} {\textsc{wot}-lim}

\DeclareMathOperator {\agm} {agm}
\DeclareMathOperator {\Ani} {Ani}
\DeclareMathOperator {\Ass} {Ass}
\DeclareMathOperator {\Aut} {Aut}
\DeclareMathOperator {\Ann} {Ann}                           		
\DeclareMathOperator {\bd} {bd}                             		
\DeclareMathOperator {\Br} {Br}
\DeclareMathOperator {\Bun} {Bun}
\DeclareMathOperator {\Burn} {Burn}					
\DeclareMathOperator {\CaCl} {CaCl}	
\DeclareMathOperator {\card} {card}			
\DeclareMathOperator {\Cat} {Cat}
\DeclareMathOperator {\CC} {C}
\DeclareMathOperator {\chr} {char}                          	
\DeclareMathOperator {\Cl} {Cl}                             
\DeclareMathOperator {\cl} {cl}              
\DeclareMathOperator {\cis} {cis}
\DeclareMathOperator {\codim} {codim}         
\DeclareMathOperator {\Coker} {Coker}         
\DeclareMathOperator {\coker} {coker}            
\DeclareMathOperator {\Coim} {Coim}        
\DeclareMathOperator {\coim} {coim}     
\DeclareMathOperator {\Col} {Col}      
\DeclareMathOperator {\Cov} {Cov}
\DeclareMathOperator {\curl} {curl}          
\let \D \relax
\DeclareMathOperator {\D} {D}               
\let \d \relax
\DeclareMathOperator {\d} {d}
\DeclareMathOperator {\Dem} {Dem}
\DeclareMathOperator {\diag} {diag}  
\DeclareMathOperator {\diam} {diam}        
\DeclareMathOperator {\Disc} {Disc} 
\DeclareMathOperator {\dist} {dist}  
\let\div\relax 
\DeclareMathOperator {\div} {div}          
\DeclareMathOperator {\Div} {Div}                
\DeclareMathOperator {\dom} {dom}  
\DeclareMathOperator {\Dom} {Dom}             
\DeclareMathOperator {\E} {E}                        
\DeclareMathOperator {\End} {End}                         
\DeclareMathOperator {\error} {error}
\DeclareMathOperator {\esssup} {{ess\ sup}}
\DeclareMathOperator {\ev} {ev}
\DeclareMathOperator {\Et} {\acute Et}
\DeclareMathOperator {\Exc} {Exc}  
\DeclareMathOperator {\ext} {ext}                   
\DeclareMathOperator {\Ext} {Ext}
\DeclareMathOperator {\Fil} {Fil}                        
\DeclareMathOperator {\Fix} {Fix}              
\DeclareMathOperator {\forget} {forget}	
\DeclareMathOperator {\free} {free}	
\DeclareMathOperator {\Free} {Free}
\DeclareMathOperator {\Frac} {Frac}
\DeclareMathOperator {\Frob} {Frob}                 
\DeclareMathOperator {\Gal} {Gal}   
\DeclareMathOperator {\GKdim} {GKdim}                    
\DeclareMathOperator {\GL} {GL}                    
\DeclareMathOperator {\Gr} {Gr}                        
\DeclareMathOperator {\Hck} {Hck}
\DeclareMathOperator {\Hess} {Hess}                
\let \Hom \relax
\DeclareMathOperator {\Hom} {Hom}                      
\DeclareMathOperator {\HH} {H}                       
\DeclareMathOperator {\h} {h}                           
\DeclareMathOperator {\Hilb} {Hilb}              
\DeclareMathOperator {\id} {id}                 
\DeclareMathOperator {\II} {I}
\DeclareMathOperator {\Img} {Im}			
\DeclareMathOperator {\img} {im}                   
\DeclareMathOperator {\Image} {Image}
\DeclareMathOperator {\Ind} {Ind}              
\DeclareMathOperator {\Inn} {Inn}                  
\DeclareMathOperator {\inr} {int}                  
\DeclareMathOperator {\ISO} {ISO}			
\DeclareMathOperator {\Jac} {Jac}                       
\DeclareMathOperator {\J} {J}    
\DeclareMathOperator {\Kdim} {Kdim}                    
\let \Ker \relax
\DeclareMathOperator {\Ker} {Ker}                    
\DeclareMathOperator {\Length} {Length}
\DeclareMathOperator {\Loc} {Loc}              
\DeclareMathOperator {\Log} {Log}         
\DeclareMathOperator {\Mat} {Mat}                   
\DeclareMathOperator {\mesh} {mesh}                
\DeclareMathOperator {\Mor} {Mor}      
\DeclareMathOperator {\Mp} {Mp}  
\DeclareMathOperator {\MSpec} {MSpec}                        
\DeclareMathOperator {\mult} {mult}                       
\DeclareMathOperator {\MM} {M}                          
\DeclareMathOperator {\Nz} {N}                             
\DeclareMathOperator {\Nil} {Nil}                           
\DeclareMathOperator {\NL} {NL}                          
\DeclareMathOperator {\Null} {Null}     
\DeclareMathOperator {\orb} {orb}                 
\DeclareMathOperator {\ord} {ord}                          
\DeclareMathOperator {\On} {On}
\DeclareMathOperator {\Out} {Out}                           
\DeclareMathOperator {\Perf} {Perf}
\DeclareMathOperator {\prp} {perp}    
\DeclareMathOperator {\Perv} {Perv}                      
\DeclareMathOperator {\Pic} {Pic}                           
\DeclareMathOperator {\pred} {pred}
\DeclareMathOperator {\pr} {pr}
\let \Pr \relax
\DeclareMathOperator {\Pr} {Pr}                         	
\DeclareMathOperator {\Proj} {Proj}                         	
\DeclareMathOperator {\proj} {proj}                         
\DeclareMathOperator {\PGL} {PGL}                    
\DeclareMathOperator {\PSL} {PSL}                           	
\DeclareMathOperator {\QQ} {Q}
\DeclareMathOperator {\RR} {R}
\DeclareMathOperator {\Ran} {Ran}                           
\DeclareMathOperator {\ran} {ran}                       
\DeclareMathOperator {\rank} {rank}  
\DeclareMathOperator {\red} {red}
\DeclareMathOperator {\Rep} {Rep}                  
\DeclareMathOperator {\Res} {Res}                 
\DeclareMathOperator {\sgn} {sgn}
\DeclareMathOperator {\Shv} {Shv}
\DeclareMathOperator {\Sht} {Sht}                                               	
\DeclareMathOperator {\SL} {SL}                             	
\DeclareMathOperator {\SO} {SO}                             
\DeclareMathOperator {\Sp} {Sp}		
\DeclareMathOperator {\Spa} {Spa}
\DeclareMathOperator {\Spd} {Spd}   			
\DeclareMathOperator {\Spec} {Spec}                         
\DeclareMathOperator {\specmax} {Specmax}   
\DeclareMathOperator {\Spf} {Spf}	
\DeclareMathOperator {\spa} {span}                         
\DeclareMathOperator {\Stab} {Stab}                          
\DeclareMathOperator {\SU} {SU}    
\DeclareMathOperator {\Supp} {Supp}                           
\DeclareMathOperator {\Syl} {Syl}                         
\let \Sym \relax
\DeclareMathOperator {\Sym} {Sym}                            	
\DeclareMathOperator {\Tor} {Tor}                       
\DeclareMathOperator {\Tr} {Tr}                             
\DeclareMathOperator {\tr} {tr}
\DeclareMathOperator {\vdim} {vdim}
\DeclareMathOperator {\Vect} {Vect}                         
\DeclareMathOperator {\Vol} {Vol}                           	
\DeclareMathOperator {\vol} {vol}                           	
\let \O \relax 
\DeclareMathOperator {\O} {O}                               	
\DeclareMathOperator {\ZZ} {Z}					

\DeclareMathOperator {\sech} {sech}                        
\DeclareMathOperator {\csch} {csch}                       

\newcommand {\etco} {\HH\sub{\'et}}


\setenumerate[1]{label=\normalfont(\arabic*)}	% enumerate label
\setenumerate[2]{label=\normalfont(\alph*)}	% second-order enumerate label

\setlist [itemize] {label = ---, leftmargin = *, wide} % topsep=0 em
\setlist [enumerate] {wide}% topsep=0 em
%\setlength{\parskip}{0pt}

\AddToHook{cmd/section/before}{\clearpage}

\ifnone	% [none]

	% ENVIRONMENTS FOR [none]:
	% 	thm [Theorem]
	%	lemma [Lemma]
	%	corollary [Corollary]
	%	proposition [Proposition]
	%	conj [Conjecture]
	%	remark [Remark]
	%	definition [Definition]
	%	defprop [Definition/Proposition]
	%	question [Question]
	%	example [Example]
	%	examples [Examples]
	%	convention [Convention]
	%	exercise [Exercise]
	%	warning [Warning]
	%	problem [Problem]
	
	\let\proof\relax		% will redefine the proof environment for style
		\let\endproof\relax	% "
	                \newtheoremstyle {thm}   	% name
                    {1 em}              	% space above
                    {1 em}              	% space below
                    {\iffalse\itshape\fi}	% body font
                    {0 em}              	% indent amount
                    {\bfseries}         	% theorem head font
                    {.}                 	% punctuation after theorem head
                    {1 em}              	% space after theorem head
                    {}                  	% theorem head spec
    
                \newtheoremstyle {defn}
                    {1 em}
                    {1 em}
                    {}
                    {0 em}
                    {\bfseries}
                    {.}
                    {1 em}
                    {}
            
                \newtheoremstyle {remark}
                    {1 em}
                    {1 em}
                    {}
                    {0 em}
                    {\bfseries}
                    {.------}
                    {0 em}
                    {}
                
                \newtheoremstyle {proof}
                    {1 em}
                    {1 em}
                    {}
                    {0 em}
                    {\bfseries}
                    {.------}
                    {0 em}
                    {}
    
			\theoremstyle {proof}
			\newtheorem* {proof} {Proof}
			\newtheorem* {pf} {Proof}
			\newtheorem* {esquisse} {Esquisse}
			
			\let \tempendproof = \endproof
			\def \endproof {\hfill\mbox{$\square$}\tempendproof}
			
			\numberwithin {equation} {section}
			\theoremstyle {thm}
			\newtheorem {thm} {Theorem}
			\numberwithin {thm} {section}
				\newtheorem {theorem} [thm] {Theorem}		
			\newtheorem {lemma} [thm] {Lemma}
			\newtheorem {corollary} [thm] {Corollary}
			\newtheorem {algorithm} [thm] {Algorithm}
			\newtheorem {proposition} [thm] {Proposition}
			\newtheorem {conj} [thm] {Conjecture}

			\theoremstyle {defn}
			\newtheorem {definition} [thm] {Definition}
			\newtheorem {defprop} [thm] {Definition/Proposition}
			\newtheorem {question} [thm] {Question}
			\newtheorem {example} [thm] {Example}
			\newtheorem {examples} [thm] {Examples}
			\newtheorem {convention} [thm] {Convention}
			\newtheorem {exercise} [thm] {Exercise}
			\newtheorem {surprise} [thm] {Surprise}
			
			\newtheorem {problem} [thm] {Problem}		

			\newtheorem {notation} [thm] {Notation}
			\newtheorem {bnotation} [thm] {Bad notation}
			
			\theoremstyle {remark}
			\newtheorem {remark} [thm] {Remark}
			\newtheorem {warn} [thm] {Warning}
			\newtheorem {ramble} [thm] {Ramble}
			
			\newenvironment {eproof} {\begin{pf}\text{}\begin{enumerate}[leftmargin=*,label=(\roman*)]} {\hfill$\square$\end{enumerate}\end{pf}}
			
			\newenvironment {iproof} {\begin{pf}\text{}\begin{itemize}} {\hfill$\square$\end{itemize}\end{pf}}
	

\else		% not [none], not [thing]
	
	\ifold	% not [none], [old]
	
		% ENVIRONMENTS FOR not [none], [old]:
		%	theorem [Theorem]
		%	example [Example]
		%	lemma [Lemma]
		%	proposition [Proposition]
		%	corollary [Corollary]
		%	theorem* [Theorem]
		%	example* [Example]
		%	lemma* [Lemma]
		%	proposition* [Proposition]
		%	corollary* [Corollary]
		%	definition [Definition]
		%	exercise [Exercise]
		%	remark [Remark]
		%	algorithm [Algorithm]
		%	algorithm* [Algorithm]
		%	tbox
		%		An empty text box
		%	warning [Warning]

		\mdfsetup {skipabove = \topskip, skipbelow = \topskip}

		\theoremstyle {definition}

		\ifjackcolour	% not [none], [old, colour]
	
			\newcommand {\defn} [1] {{\bf{\color{Blue} #1}}} % emphasize keywords with bolded blue
	
			\ifevan	% not [none], [old, colour, evan]
					% Evan Chen--inspired theme 
	 				% See https://github.com/vEnhance/dotfiles/blob/main/texmf/tex/latex/evan/evan.sty

				\mdfdefinestyle {bluebox} {
					roundcorner = 10 pt,
					linewidth = 1 pt,
					innerbottommargin =10pt,
					linecolor = blue,
					nobreak = false,
					backgroundcolor = TealBlue!5,}

				\mdfdefinestyle {redbox} {
					linewidth = 0.5 pt,
					innerbottommargin = 10 pt,
					backgroundcolor = Salmon!5,
					linecolor = black,}

					
				\declaretheoremstyle [
					headfont = \bfseries \color {MidnightBlue},
					mdframed = {style = bluebox},
					headpunct = {\\[3 pt]},
					postheadspace = {0 pt},] {theorembox}

				\declaretheoremstyle [
					headfont = \bfseries \color {RawSienna},
					mdframed = {style = redbox},
					headpunct = {\\[3 pt]},
					postheadspace = {0 pt}] {examplebox}
						

			\else	 % not [none], not [colour], [old]

				\mdfdefinestyle {colourthm} {
					linewidth = 2 pt,
					%leftline = true,
					rightline = false,
					topline = false,
					bottomline = false,
					linecolor = MidnightBlue,
					%innerbottommargin =10pt,
					backgroundcolor = Cerulean!5,}

				\mdfdefinestyle {colourexp} {
					linewidth = 2 pt,
					leftline = true,
					rightline = false,
					topline = false,
					bottomline = false,
					linecolor = RawSienna,
					backgroundcolor = Salmon!5,}
		
				\mdfdefinestyle {colouralg} {
					linewidth = 2 pt,
					leftline = true,
					rightline = false,
					topline = false,
					bottomline = false,
					linecolor = OliveGreen,
					backgroundcolor = OliveGreen!5,}


				\declaretheoremstyle [
					headfont = \bfseries \color {MidnightBlue},
					bodyfont = \normalfont ,
					mdframed = {style = colourthm},
					headpunct = {\\[3 pt]},
					postheadspace = {0 pt},] {theorembox}

				\declaretheoremstyle [
					headfont = \bfseries \color {RawSienna},
					mdframed = {style = colourexp},
					headpunct = {\\[3 pt]},
					postheadspace = {0 pt},] {examplebox}

				\declaretheoremstyle [
					headfont = \bfseries \color {OliveGreen},
					mdframed = {style = colouralg},
					headpunct = {\\[3 pt]},
					postheadspace = {0 pt},] {algbox}
						
						
			\fi

		\else		% not [none], not [colour], [old]

			\newcommand{\defn}[1]{\textit {#1}}	% emphasize keywords with italics

			\declaretheoremstyle [
				bodyfont = \normalfont \itshape,] {theorembox}

			\declaretheoremstyle [
				bodyfont = \normalfont,] {examplebox}

			\declaretheoremstyle [
				bodyfont = \normalfont,] {algbox}

		\fi 

		\ifjacksection

			\declaretheorem [style = theorembox, name = Theorem, numberwithin = section]  {theorem}
			\declaretheorem [style = examplebox, name = Example, sibling = theorem] {example}
			\declaretheorem [style = theorembox, name = Lemma, sibling = theorem] {lemma}
			\declaretheorem [style = theorembox, name = Proposition, sibling = theorem] {proposition}	
			\declaretheorem [style = theorembox, name = Corollary, sibling = theorem] {corollary}	
			\declaretheorem [style = theorembox, name = Theorem, numbered = no] {theorem*}		
			\declaretheorem [style = theorembox, name = Lemma, numbered = no] {lemma*}		
			\declaretheorem [style = theorembox, name = Proposition, numbered = no] {proposition*}			
			\declaretheorem [style = theorembox, name = Corollary, numbered = no] {corollary*}
			\declaretheorem [name = Definition,  sibling = theorem] {definition}
			\declaretheorem [name = Exercise,  sibling = theorem] {exercise}
			\declaretheorem [name = Remark, sibling = theorem] {remark}
			\declaretheorem [style = algbox, name = Algorithm, sibling = theorem] {algorithm}
			\declaretheorem [style = algbox, name = Algorithm, sibling = theorem] {algorithm*}
	
		\else

			\declaretheorem [style = theorembox, name = Theorem]  {theorem}
			\declaretheorem [style = examplebox, name = Example, sibling = theorem] {example}
			\declaretheorem [style = theorembox, name = Lemma, sibling = theorem] {lemma}
			\declaretheorem [style = theorembox, name = Proposition, sibling = theorem] {proposition}	
			\declaretheorem [style = theorembox, name = Corollary, sibling = theorem] {corollary}	
			\declaretheorem [style = theorembox, name = Theorem, numbered = no] {theorem*}		
			\declaretheorem [style = theorembox, name = Lemma, numbered = no] {lemma*}		
			\declaretheorem [style = theorembox, name = Proposition, numbered = no] {proposition*}			
			\declaretheorem [style = theorembox, name = Corollary, numbered = no] {corollary*}
			\declaretheorem [name = Definition,  sibling = theorem] {definition}
			\declaretheorem [name = Exercise,  sibling = theorem] {exercise}
			\decl	aretheorem [name = Remark, sibling = theorem] {remark}
			\declaretheorem [style = algbox, name = Algorithm, sibling = theorem] {algorithm}
			\declaretheorem [style = algbox, name = Algorithm, sibling = theorem] {algorithm*}

		\fi

		\mdfdefinestyle {plainbox} {}

		\newenvironment {tbox} {\begin {mdframed} [style = plainbox]} {\end{mdframed}}
		\newenvironment {warning} {\begin {mdframed} [style = plainbox] \dbend \begin {addmargin} [2em] {0em} \vspace*{-12pt}} {\end {addmargin}\end {mdframed}}	% quasi-Bourbaki--style warning environment


	\else	% not [old]
	
	
		% ENVIRONMENTS FOR not [old]:
		% 	esquisse [Esquisse] (for proof sketches)
		%	thm [Theorem]
		%	theorem [Theorem]
		%	lemma [Lemma]
		%	corollary [Corollary]
		%	proposition [Proposition]
		%	conj [Conjecture]
		%	definition [Definition]
		%	defprop [Definition/Proposition]
		%	question [Question]
		%	example [Example]
		%	examples [Examples]
		%	convention [Convention]
		%	exercise [Exercise]
		%	problem [Problem]
		%	notation [Notation]
		%	bnotation [Bad notation]
		%	remark [Remark]
		%	warn [Warning]
		%	ramble [Ramble]
		%	eproof [Proof] (builtin itemize for proper formatting with enumerates and QED symbol)
		%		\begin{eproof}
		%			\item [something]
		%			\item [something]
		%		\end{eproof}


		\let\proof\relax		% will redefine the proof environment for style
		\let\endproof\relax	% "
		
		\definecolor{darkcandyapplered}{rgb}{0.64, 0.0, 0.0}
		
		\newcommand {\defn} [1] {{{\bfseries #1}}}		% key words emphasized by underline
		\newcommand {\frdefn} [1] {{\iffalse\slshape \fi\emph{\bfseries\color{darkcandyapplered} #1}}}	% French key words emphasized by bolded red with appropriate italicization
        
                 \ifplaintitle
                 
                  \newtheoremstyle {thm}   	% name
                    {1 em}              	% space above
                    {1 em}              	% space below
                    {}	            % body font
                    {0 em}              	% indent amount
                    {\scshape}         	% theorem head font
                    {.}                 	% punctuation after theorem head
                    {\newline}              % space after theorem head
                    {\thmname{#1}\thmnote{: #3}}                  	% theorem head spec
                    % \thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}
    
                \newtheoremstyle {defn}
                    {1 em}
                    {1 em}
                    {}
                    {0 em}
                    {\scshape}
                    {.}
                    {\newline}
                    {\thmname{#1}\thmnote{: #3}}
            
                \newtheoremstyle {remark}
                    {1 em}
                    {1 em}
                    {}
                    {0 em}
                    {\scshape}
                    {.}
                    {\newline}
                    {\thmname{#1}\thmnote{ --- #3}}
                
                \newtheoremstyle {proof}
                    {1 em}
                    {1 em}
                    {}
                    {0 em}
                    {\scshape}
                    {.}
                    {\newline}
                    {\thmname{#1}\thmnote{ --- #3}}
                 \else
                  \newtheoremstyle {thm}   	% name
                    {1 em}              	% space above
                    {1 em}              	% space below
                    {\itshape}	            % body font
                    {0 em}              	% indent amount
                    {\bfseries}         	% theorem head font
                    {.}                 	% punctuation after theorem head
                    {1 em}              % space after theorem head
                    {\thmname{#1}\thmnumber{ #2}\thmnote{. #3}}                  	% theorem head spec
                    % \thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}
    
                \newtheoremstyle {defn}
                    {1 em}
                    {1 em}
                    {}
                    {0 em}
                    {\bfseries}
                    {.}
                    {1 em}
                    {\thmname{#1}\thmnumber{ #2}\thmnote{. #3}}
            
                \newtheoremstyle {remark}
                    {1 em}
                    {1 em}
                    {}
                    {0 em}
                    {\bfseries}
                    {.}
                    {1 em}
                    {\thmname{#1}\thmnumber{ #2}\thmnote{. #3}}
                
                \newtheoremstyle {proof}
                    {1 em}
                    {1 em}
                    {}
                    {0 em}
                    {\bfseries}
                    {.}
                    {1 em}
                    {\thmname{#1}\thmnumber{ #2}\thmnote{. #3}}
                 \fi
               
                
           				
			\theoremstyle {proof}
			\newtheorem* {proof} {Proof}
			\newtheorem* {pf} {Proof}
			\newtheorem* {esquisse} {Esquisse}
			
			\let \tempendproof = \endproof
			\def \endproof {\hfill\mbox{$\square$}\tempendproof}
			
			\numberwithin {equation} {section}
			\theoremstyle {thm}
			\newtheorem {thm} {Theorem}
			\numberwithin {thm} {section}
			\ifassg	% if this is in an assignment, ignore sections
				\newtheorem {theorem} {Theorem}
			\else
				\newtheorem {theorem} [thm] {Theorem}		
			\fi
			\newtheorem {lemma} [thm] {Lemma}
			\newtheorem {corollary} [thm] {Corollary}
			\newtheorem {algorithm} [thm] {Algorithm}
			\newtheorem {proposition} [thm] {Proposition}
			\newtheorem {conj} [thm] {Conjecture}

			\theoremstyle {defn}
			\newtheorem {definition} [thm] {Definition}
			\newtheorem {defprop} [thm] {Definition/Proposition}
			\newtheorem {question} [thm] {Question}
			\newtheorem {example} [thm] {Example}
			\newtheorem {examples} [thm] {Examples}
			\newtheorem {convention} [thm] {Convention}
			\newtheorem {exercise} [thm] {Exercise}
			\newtheorem {surprise} [thm] {Surprise}
			
			\ifassg	% if this is in an assignment, ignore sections
				\newtheorem {problem} {Problem}	
			\else
				\newtheorem {problem} [thm] {Problem}		
			\fi

			\newtheorem {notation} [thm] {Notation}
			\newtheorem {bnotation} [thm] {Bad notation}
			
			\theoremstyle {remark}
			\newtheorem {remark} [thm] {Remark}
			\newtheorem {warn} [thm] {Warning}
			\newtheorem {ramble} [thm] {Ramble}
			
			\newenvironment {eproof} {\begin{pf}\text{}\begin{enumerate}} {\hfill$\square$\end{enumerate}\end{pf}}
			
			\newenvironment {iproof} {\begin{pf}\text{}\begin{itemize}} {\hfill$\square$\end{itemize}\end{pf}}

			\ifjackcourse	% not [none], [course]
			
				% REQUIREMENTS FOR not [none], [course]:
				% 	Define `jtitle` for title
				% 	Define `jlecturer` for lecturer
				% 	Define `jterm` for current term
				% 	Define `jauthor` for you, the person writing this
				%		\def \jtitle {Linear Algebra 2}
				%		\def \jlecturer {Dr. John Smith}
				%		\def \jterm {Spring 2022}
				%		\def \jauthor {Me}
				
				
				% \geometry {left = 0.5 in, bottom = 1 in, right = 0.5 in, top = 1 in, rmargin = 1 in}
				\geometry {left = 1 in, bottom = 1.5 in, right = 1 in, top = 1.5 in, inner = 1.5 in, outer = 1.5 in}
				
				\iffalse%\ifscr
					
				\else

					\makeatletter
						%\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}} 
					
						\def\title#1{\gdef\@title{#1}\gdef\THETITLE{#1}}

						% redefining `\maketitle` such that it is better suited for courses
						\renewcommand \maketitle{
							\thispagestyle{empty}
								{\raggedright 
								\begin{center}
									{\Large\scshape \jtitle}\\\vspace*{1 em}
									{\large Based on lectures by \jlecturer}\text{}\\
									{\normalsize Written by \jauthor}\text{}\\
									{\small Last updated on \today}\\\vspace*{0.666666 em}
									{\large \jterm}
								\end{center}}}
					\makeatother
                            
					\makeatletter
						\renewcommand{\@seccntformat}[1]{\csname the#1\endcsname.\quad}
					\makeatother
					
                            		% consider making `\bfseries\scshape' when possible
		
                            		%\ifluatex %%%%%
                            			\makeatletter
                                			\renewcommand{\section}{\@startsection
                                    				{section}           % name
                                    				{1}                 % level
                                    				{\z@}               % the indent / 0mm
                                    				{-\baselineskip}    % before skip / -3.5ex \@plus -1ex \@minus -.2ex
                                    				{0.5\baselineskip}  % after skip / 2.3ex \@plus .2ex
                                    				{\centering\bfseries}}  % style
                            			\makeatother
                
                            			\makeatletter
                                			\renewcommand{\subsection}{\@startsection
                                    				{subsection}            % name
                                    				{2}                     % level
                                    				{\z@}                   % the indent / 0mm
                                    				{-\baselineskip}        % before skip / -3.5ex \@plus -1ex \@minus -.2ex
                                    				{0.5\baselineskip}      % after skip / 2.3ex \@plus .2ex
                                    				{\scshape}}  % style
                            			\makeatother	
			
										\makeatletter
            								\renewcommand{\subsubsection}{\@startsection
            									{subsubsection}		% name
            									{3}				% level
            									{\z@}			% the indent / 0mm
            									{-\baselineskip}	% before skip / -3.5ex \@plus -1ex \@minus -.2ex
            									{0.5\baselineskip}	% after skip / 2.3ex \@plus .2ex
            									{}} 				% style
            							\makeatother
							%\fi %%%%%
                            
                            
        				\makeatletter	% https://tex.stackexchange.com/questions/94853/section-and-subsection-alternating-in-the-header
        					\xapptocmd{\@sect}{\csname #1mark\endcsname{#7}}{}{}
        				\makeatother 
					
        				\ifscr
					
					\else	% setting up the headers and footers
					
        					\pagestyle{fancy} 
        					\renewcommand{\sectionmark}[1]{\markright{#1}}
        					\renewcommand{\subsectionmark}[1]{}
        					\fancyhf{}
        			
        				
        					\ifams
        						\renewcommand{\sectionmark}[1]{\markleft{#1}}
        					\fi
        				
        					\fancyhead[CO]{\small \scshape\jtitle}
							\fancyhead[CE]{\small \scshape\nouppercase\rightmark}
							\fancyhead[LE,RO]{\footnotesize \thepage}
							\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
        					%\fancyhead[R]{\nouppercase\rightmark}
        					%\cfoot{\text{}\\\thepage}

						\ifindex
        						\makeindex
        						\indexsetup {othercode = {\thispagestyle {fancy}}}
						\fi
					\fi
				\fi
				
			\else
			
				\ifjackannot	% not [none], not [course], [annot]
				
					% REQUIREMENTS FOR not [none], not [course], [annot]:
					% 	Define `jtitle` for title
					% 	Define `jauthor` for you, the person writing this
					%		\def \jtitle {Title}
					%		\def \jauthor {Me}
					
					\geometry{left = 0.5 in, right = 0.5 in, top = 1 in, bottom = 1 in}
			
					\iffalse%\ifscr
					
					\else

					% previous attempt to customize \maketitle
						\makeatletter
						%\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}} 
					
							\def\title#1{\gdef\@title{#1}\gdef\THETITLE{#1}}

							\renewcommand \maketitle{
								\thispagestyle{empty}
								\text{}
									{\raggedright 
									\begin{center}
										{\Large\scshape \jtitle}\\\vspace*{1 em}
										{\normalsize Written by \jauthor}\text{}\\
										{\small Last updated on \today}\\\vspace*{0.666666 em}
									\end{center}}
								}
						\makeatother
					
						\ifscr
						
						\else
				
							\makeatletter
								\renewcommand{\section}{\@startsection
									{section}			% name
									{1}				% level
									{\z@}			% the indent / 0mm
									{-\baselineskip}	% before skip / -3.5ex \@plus -1ex \@minus -.2ex
									{0.5\baselineskip}	% after skip / 2.3ex \@plus .2ex
									{\centering\bfseries}} 	% style
							\makeatother
				
							\makeatletter
								\renewcommand{\subsection}{\@startsection
									{subsection}		% name
									{2}				% level
									{\z@}			% the indent / 0mm
									{-\baselineskip}	% before skip / -3.5ex \@plus -1ex \@minus -.2ex
									{0.5\baselineskip}	% after skip / 2.3ex \@plus .2ex
									{}} 				% style
							\makeatother
				
							\makeatletter	% https://tex.stackexchange.com/questions/94853/section-and-subsection-alternating-in-the-header
								\xapptocmd{\@sect}{\csname #1mark\endcsname{#7}}{}{}
							\makeatother 
				
							\makeatletter
								\renewcommand*{\@seccntformat}[1]{\csname the#1\endcsname .\ }
							\makeatother
					
						\fi
				
					\fi

				\ifscr
				
				\else
				
					\pagestyle{fancy} 
					\renewcommand{\sectionmark}[1]{\markright{#1}}
					\renewcommand{\subsectionmark}[1]{}
					\fancyhf{}
			
				
					\ifams
						\renewcommand{\sectionmark}[1]{\markleft{#1}}
					\fi
				
				
					\fancyhead[L]{\jtitle}
					\fancyhead[R]{\nouppercase\rightmark}
					\cfoot{\text{}\\\thepage}
					
					\ifindex
        						\makeindex
        						\indexsetup {othercode = {\thispagestyle {fancy}}}
					\fi
				\fi
				
			\else
			
				\ifplaintitle
					\geometry {left = 0.5 in, bottom = 1 in, right = 0.5 in, top = 0.5 in}
				\fi
			
			\fi
			
		\fi
	\fi
\fi

\iftesting %%%%% BEGINNING OF TESTING

%% getting theorem style error for proof environment when amsthm loaded before, obvious error when loaded after ...

\RequirePackage {mathpazo}
\RequirePackage {eucal}

\RequirePackage [titles] {tocloft}
\renewcommand*{\cftbeforesecskip}{0 em}
\renewcommand{\cftsecfont}{\normalfont}
\renewcommand{\cftsecpagefont}{\normalfont}
\renewcommand{\cftsecnumwidth}{3 em}
\renewcommand{\cftsecaftersnum}{.}
%\AddToHook{cmd/section/before}{\clearpage}


\setcounter {tocdepth} {1}
%\setcounter {tocdepth} {2}

\geometry {left = 0.5 in, bottom = 1 in, right = 0.5 in, top = 1 in, inner = 1 in, outer = 0.5 in}
				

					\makeatletter
						%\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}} 
					
						\def\title#1{\gdef\@title{#1}\gdef\THETITLE{#1}}

						% redefining `\maketitle` such that it is better suited for courses
						\renewcommand \maketitle{
							\thispagestyle{empty}
								{\raggedright 
								\begin{center}
									{\Large\scshape \jtitle}\\\vspace*{1 em}
									{\large Based on lectures by \jlecturer}\text{}\\
									{\normalsize Scribed by \jauthor}\text{}\\
									{\small Last updated on \today}\\\vspace*{0.666666 em}
									{\large \jterm}
								\end{center}}}
					\makeatother
                            
					\makeatletter
						\renewcommand{\@seccntformat}[1]{\csname the#1\endcsname.\quad}
					\makeatother
					
                            		% consider making `\bfseries\scshape' when possible
                            		%\ifluatex
                            			\makeatletter
                                			\renewcommand{\section}{\@startsection
                                    				{section}           % name
                                    				{1}                 % level
                                    				{\z@}               % the indent / 0mm
                                    				{-\baselineskip}    % before skip / -3.5ex \@plus -1ex \@minus -.2ex
                                    				{0.5\baselineskip}  % after skip / 2.3ex \@plus .2ex
                                    				{\centering\bfseries\large}}  % style
                            			\makeatother
                
                            			\makeatletter
                                			\renewcommand{\subsection}{\@startsection
                                    				{subsection}            % name
                                    				{2}                     % level
                                    				{\z@}                   % the indent / 0mm
                                    				{-\baselineskip}        % before skip / -3.5ex \@plus -1ex \@minus -.2ex
                                    				{0.5\baselineskip}      % after skip / 2.3ex \@plus .2ex
                                    				{\bfseries\large}}  % style
                            			\makeatother	
			
										\makeatletter
            								\renewcommand{\subsubsection}{\@startsection
            									{subsubsection}		% name
            									{3}				% level
            									{\z@}			% the indent / 0mm
            									{-\baselineskip}	% before skip / -3.5ex \@plus -1ex \@minus -.2ex
            									{0.5\baselineskip}	% after skip / 2.3ex \@plus .2ex
            									{\bfseries}} 				% style
            							\makeatother
					%\fi 
                            
                            
        				\makeatletter	% https://tex.stackexchange.com/questions/94853/section-and-subsection-alternating-in-the-header
        					\xapptocmd{\@sect}{\csname #1mark\endcsname{#7}}{}{}
        				\makeatother 
					
					
					
        					\pagestyle{fancy} 
        					\renewcommand{\sectionmark}[1]{\markright{#1}}
        					\renewcommand{\subsectionmark}[1]{}
        					\fancyhf{}
					\renewcommand{\headrulewidth}{0pt}
        			
        				
        					\ifams
        						\renewcommand{\sectionmark}[1]{\markleft{#1}}
        					\fi
        				
        					\fancyhead[LE]{\footnotesize\thepage}
							\fancyhead[RO]{\footnotesize\thepage}
        					\fancyhead[RE]{\footnotesize\nouppercase\jtitle}
							\fancyhead[LO]{\footnotesize\nouppercase\rightmark}
        					%\cfoot{\text{}\\\thepage}

						\ifindex
        						\makeindex
        						\indexsetup {othercode = {\thispagestyle {fancy}}}
						\fi
												%%PS
												
						


\fi %%%%%%% END OF TESTING



\endinput
